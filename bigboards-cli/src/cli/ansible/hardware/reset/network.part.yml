- name: generate a correct mac address for the internal interface
  shell: echo "02$(cat /sys/class/net/eth0/address |cut -c 3-17)"
  register: bb_nic_ext_mac

- name: get the current netmask
  shell: ifconfig eth0 |grep "Mask:" | tr -s ' ' | cut -d ' ' -f5 | cut -d ':' -f2
  register: bb_netmask

- name: get the current ip address
  shell: ifconfig eth0 |grep "Mask:" | tr -s ' ' | cut -d ' ' -f3 | cut -d ':' -f2
  register: bb_node_address

- name: make sure the network interfaces are set correctly
  template:
    src: "templates/interfaces"
    dest: "/etc/network/interfaces"

- name: make sure the network hosts are set correctly
  template:
    src: "templates/hosts"
    dest: "/etc/hosts"

- name: make sure the ntp.conf file is up to date
  template:
    src: "templates/ntp.conf"
    dest: "/etc/ntp.conf"

- name: make sure the ntp defaults file is up to date
  copy:
    src: "files/ntp"
    dest: "/etc/default/ntp"

- name: make sure the dhcp configuration is set correctly
  template:
    src: "templates/dhclient.conf"
    dest: "/etc/dhcp/dhclient.conf"