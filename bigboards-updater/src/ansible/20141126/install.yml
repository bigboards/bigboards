---
- hosts: host
  sudo: yes
  tasks:
    - name: be sure the serf files are up to date
      copy: src=files/{{ item }} dest=/{{ item }}
      with_items:
        - etc/default/serf
        - etc/init/serf.conf
        - etc/network/if-down.d/serf
        - etc/network/if-up.d/serf
        - etc/dhcp/dhclient-exit-hooks.d/serf
      notify: Restart Serf

    - name: be sure serf has the right configuration
      template: src=templates/etc/serf/serf.conf dest=/etc/serf/serf.conf
      notify: Restart Serf

    - name: be sure the network configuration is accurate
      template: src=templates/etc/{{ item }} dest=/etc/{{ item }}
      with_items:
        - dhcp/dhclient.conf
        - resolv.conf

    - name: make sure the bigboards log directory is available
      file: state=directory path=/var/log/bigboards owner=bb mode=666

  handlers:
    - name: Restart Serf
      service: name=serf state=restarted